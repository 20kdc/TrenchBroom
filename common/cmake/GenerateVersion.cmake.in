macro(get_app_version GIT_DESCRIBE VERSION_YEAR VERSION_NUMBER)
    if(NOT ${GIT_DESCRIBE})
        set(${GIT_DESCRIBE} "v0000.0")
    endif()
    string(REGEX MATCH "v([0-9][0-9][0-9][0-9])[.]([0-9]+)" GIT_DESCRIBE_MATCH "${${GIT_DESCRIBE}}")

    if(GIT_DESCRIBE_MATCH)
        set(${VERSION_YEAR} ${CMAKE_MATCH_1})
        set(${VERSION_NUMBER} ${CMAKE_MATCH_2})
    else()
        message(FATAL_ERROR "Couldn't parse version from git describe output '${${GIT_DESCRIBE}}'")
    endif()
endmacro(get_app_version)

macro(get_git_describe GIT SOURCE_DIR GIT_DESCRIBE)
    execute_process(COMMAND ${GIT} describe --dirty WORKING_DIRECTORY ${SOURCE_DIR} OUTPUT_VARIABLE ${GIT_DESCRIBE} OUTPUT_STRIP_TRAILING_WHITESPACE)
endmacro(get_git_describe)

get_git_describe("@GIT_EXECUTABLE@" "@CMAKE_SOURCE_DIR@" GIT_DESCRIBE)
get_app_version(GIT_DESCRIBE APP_VERSION_YEAR APP_VERSION_NUMBER)
set(APP_BUILD_TYPE "@CMAKE_BUILD_TYPE@")

configure_file("@COMMON_SOURCE_DIR@/Version.h.in" "@CMAKE_CURRENT_BINARY_DIR@/Version.h" @ONLY)
