@ECHO OFF

cmake -G "@CMAKE_GENERATOR@" "@CMAKE_SOURCE_DIR@"
cmake --build . --config Release

cd Release
TrenchBroom-Test
IF NOT ERRORLEVEL 0 GOTO error
cd ..

cmake --build . --config Release --target package
cmake --build . --config Release --target publish

:error
ECHO "Unit tests failed, aborting build."
EXIT /B 1
